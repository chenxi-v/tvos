import{j as e,k as H,d as P,m as l,E as O,F as B,t as F}from"./ui-vendor-CFaKPCyu.js";import{h as K,u as U,r as d}from"./react-vendor-CM6QddGd.js";import{u as V,a as W}from"./api.service-DhptIegH.js";import{g as Y,c as q,i as G,h as J,A as Q,j as X,k as Z}from"./index-WylA89_W.js";function re(){const{sourceCode:N,vodId:w}=K(),I=U(),{videoAPIs:S}=Y(),{playback:z,home:_}=q();G();const[t,R]=d.useState(null),[T,$]=d.useState(!0),[o,C]=d.useState(z.defaultEpisodeOrder==="desc"),[k,A]=d.useState(""),[v,D]=d.useState(100);d.useEffect(()=>{const a=()=>{const r=window.innerWidth;let s=2,i=8;r>=1024?(s=8,i=5):r>=768?(s=6,i=6):r>=640&&(s=3,i=8),D(s*i)};return a(),window.addEventListener("resize",a),()=>window.removeEventListener("resize",a)},[]),V(t?.videoInfo?.title||"视频详情");const c=()=>t?.videoInfo?.title||"",E=()=>t?.videoInfo?.cover||"https://via.placeholder.com/300x400?text=暂无封面",m=()=>t?.videoInfo?.type||"",g=()=>t?.videoInfo?.year||"",p=()=>t?.videoInfo?.director||"",h=()=>t?.videoInfo?.actor||"",y=()=>t?.videoInfo?.area||"",u=()=>t?.videoInfo?.desc||"",f=()=>t?.videoInfo?.source_name||"",j=d.useMemo(()=>{const a=t?.videoInfo?.episodes_names?.length||0;if(a===0)return[];const r=[];if(o)for(let s=0;s<a;s+=v){const i=s,n=Math.min(s+v-1,a-1),x=a-i,b=a-n;r.push({label:`${x}-${b}`,value:`${i}-${n}`,start:i,end:n})}else for(let s=0;s<a;s+=v){const i=s,n=Math.min(s+v-1,a-1);r.push({label:`${i+1}-${n+1}`,value:`${i}-${n}`,start:i,end:n})}return r},[t?.videoInfo?.episodes_names?.length,v,o]),M=d.useMemo(()=>{if(!k||!t?.videoInfo?.episodes_names)return[];const[a,r]=k.split("-").map(Number),s=t.videoInfo.episodes_names.length,i=t.videoInfo.episodes_names;if(o){const n=[];for(let x=a;x<=r;x++){const b=s-1-x;b>=0&&b<s&&n.push({name:i[b],displayIndex:x,actualIndex:b})}return n}else return i.slice(a,r+1).map((n,x)=>({name:n,displayIndex:a+x,actualIndex:a+x}))},[k,t?.videoInfo?.episodes_names,o]);d.useEffect(()=>{(async()=>{if(!(!N||!w)){$(!0);try{const r=S.find(i=>i.id===N);if(!r)throw new Error("未找到对应的API配置");const s=await W.getVideoDetail(w,r);R(s)}catch(r){console.error("获取视频详情失败:",r)}finally{$(!1)}}})()},[N,w,S]),d.useEffect(()=>{j.length!==0&&A(j[0].value)},[j,o]);const L=a=>{const r=o?(t?.videoInfo?.episodes_names?.length||0)-1-a:a;I(`/video/${N}/${w}/${r}`)};return T?e.jsx("div",{className:"flex min-h-screen items-center justify-center p-4",children:e.jsxs("div",{className:"text-center",children:[e.jsx(H,{size:"lg"}),e.jsx("p",{className:"mt-4 text-gray-500 dark:text-gray-400",children:"正在加载视频详情..."})]})}):!t||t.code!==200?e.jsx("div",{className:"flex min-h-screen items-center justify-center p-4",children:e.jsxs("div",{className:"rounded-2xl bg-white/40 p-8 text-center shadow-xl backdrop-blur-xl dark:bg-white/10",children:[e.jsx("p",{className:"mb-4 text-gray-500 dark:text-gray-400",children:"获取视频详情失败"}),e.jsx(P,{className:"bg-gradient-to-r from-blue-500 to-purple-500 font-medium text-white",onPress:()=>I(-1),children:"返回"})]})}):e.jsxs("div",{className:"container mx-auto max-w-6xl overflow-x-hidden p-2 pb-20 pt-20 sm:p-4 sm:pt-4 md:pt-8",children:[e.jsx(J,{showSettings:!1}),e.jsx("div",{className:"mb-4 flex items-center justify-end",children:e.jsx(l.div,{whileHover:{scale:1.02},whileTap:{scale:.98},children:e.jsxs(P,{className:"gap-2 rounded-xl bg-black text-white shadow-lg transition-all duration-300 hover:bg-black/80",onPress:()=>I(-1),children:[e.jsx(Q,{size:18}),e.jsx("span",{className:"font-medium",children:"返回"})]})})}),e.jsxs(l.div,{className:"flex flex-col gap-4 md:flex-row md:gap-6",initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5},children:[e.jsx(l.div,{className:"hidden md:block",initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},transition:{duration:.5,delay:.1},children:e.jsx("div",{className:"overflow-hidden rounded-2xl shadow-2xl shadow-black/20",children:e.jsx("img",{src:E(),alt:c(),className:`object-cover ${_.posterAspectRatio==="16/9"?"aspect-video h-[180px] w-[320px]":"aspect-[3/4] h-[320px] w-[220px]"}`})})}),e.jsxs(l.div,{className:"flex-1 overflow-hidden rounded-2xl bg-white/40 shadow-xl shadow-black/5 backdrop-blur-xl dark:bg-white/10",initial:{opacity:0,x:20},animate:{opacity:1,x:0},transition:{duration:.5,delay:.2},children:[e.jsxs("div",{className:"md:hidden",children:[_.posterAspectRatio==="16/9"?e.jsxs("div",{className:"flex flex-col gap-4 p-4",children:[e.jsx(l.img,{src:E(),alt:c(),className:"aspect-video w-full rounded-xl object-cover shadow-lg",initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},transition:{duration:.4,delay:.25}}),e.jsxs(l.div,{className:"flex flex-col gap-2",initial:{opacity:0,x:10},animate:{opacity:1,x:0},transition:{duration:.4,delay:.3},children:[c()&&e.jsx("h1",{className:"line-clamp-2 text-lg font-bold leading-tight text-gray-900 dark:text-white",children:c()}),e.jsxs("div",{className:"flex flex-wrap gap-1",children:[f()&&e.jsx("span",{className:"rounded-full bg-gradient-to-r from-blue-500 to-purple-500 px-2 py-0.5 text-xs font-medium text-white",children:f()}),g()&&e.jsx("span",{className:"rounded-full bg-gray-200 px-2 py-0.5 text-xs font-medium text-gray-700 dark:bg-gray-700 dark:text-gray-200",children:g()}),m()&&e.jsx("span",{className:"rounded-full bg-gray-200 px-2 py-0.5 text-xs font-medium text-gray-700 dark:bg-gray-700 dark:text-gray-200",children:m()}),y()&&e.jsx("span",{className:"rounded-full bg-gray-200 px-2 py-0.5 text-xs font-medium text-gray-700 dark:bg-gray-700 dark:text-gray-200",children:y()})]}),e.jsxs("div",{className:"mt-1 text-xs text-gray-600 dark:text-gray-300",children:[p()&&e.jsxs("p",{className:"line-clamp-1",children:[e.jsx("span",{className:"font-medium text-gray-800 dark:text-gray-200",children:"导演："}),p()]}),h()&&e.jsxs("p",{className:"line-clamp-2",children:[e.jsx("span",{className:"font-medium text-gray-800 dark:text-gray-200",children:"演员："}),h()]})]})]}),u()&&e.jsx("div",{className:"border-t border-gray-200/50 pt-4 dark:border-gray-700/50",children:e.jsx("div",{className:"line-clamp-4 text-sm text-gray-600 dark:text-gray-300",dangerouslySetInnerHTML:{__html:u()}})})]}):e.jsxs("div",{className:"flex gap-4 p-4",children:[e.jsx(l.img,{src:E(),alt:c(),className:"aspect-[3/4] h-[180px] w-[120px] rounded-xl object-cover shadow-lg",initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},transition:{duration:.4,delay:.25}}),e.jsxs(l.div,{className:"flex flex-1 flex-col gap-2",initial:{opacity:0,x:10},animate:{opacity:1,x:0},transition:{duration:.4,delay:.3},children:[c()&&e.jsx("h1",{className:"line-clamp-2 text-lg font-bold leading-tight text-gray-900 dark:text-white",children:c()}),e.jsxs("div",{className:"flex flex-wrap gap-1",children:[f()&&e.jsx("span",{className:"rounded-full bg-gradient-to-r from-blue-500 to-purple-500 px-2 py-0.5 text-xs font-medium text-white",children:f()}),g()&&e.jsx("span",{className:"rounded-full bg-gray-200 px-2 py-0.5 text-xs font-medium text-gray-700 dark:bg-gray-700 dark:text-gray-200",children:g()}),m()&&e.jsx("span",{className:"rounded-full bg-gray-200 px-2 py-0.5 text-xs font-medium text-gray-700 dark:bg-gray-700 dark:text-gray-200",children:m()}),y()&&e.jsx("span",{className:"rounded-full bg-gray-200 px-2 py-0.5 text-xs font-medium text-gray-700 dark:bg-gray-700 dark:text-gray-200",children:y()})]}),e.jsxs("div",{className:"mt-1 text-xs text-gray-600 dark:text-gray-300",children:[p()&&e.jsxs("p",{className:"line-clamp-1",children:[e.jsx("span",{className:"font-medium text-gray-800 dark:text-gray-200",children:"导演："}),p()]}),h()&&e.jsxs("p",{className:"line-clamp-2",children:[e.jsx("span",{className:"font-medium text-gray-800 dark:text-gray-200",children:"演员："}),h()]})]})]})]}),u()&&_.posterAspectRatio!=="16/9"&&e.jsx("div",{className:"border-t border-gray-200/50 p-4 dark:border-gray-700/50",children:e.jsx("div",{className:"line-clamp-4 text-sm text-gray-600 dark:text-gray-300",dangerouslySetInnerHTML:{__html:u()}})})]}),e.jsx("div",{className:"hidden md:block",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"mb-4",children:[c()&&e.jsx(l.h1,{className:"mb-3 text-2xl font-bold text-gray-900 dark:text-white",initial:{opacity:0,y:-10},animate:{opacity:1,y:0},transition:{duration:.4,delay:.3},children:c()}),e.jsxs(l.div,{className:"flex flex-wrap gap-2",initial:{opacity:0},animate:{opacity:1},transition:{duration:.4,delay:.4},children:[f()&&e.jsx("span",{className:"rounded-full bg-gradient-to-r from-blue-500 to-purple-500 px-3 py-1 text-sm font-medium text-white",children:f()}),g()&&e.jsx("span",{className:"rounded-full bg-gray-200 px-3 py-1 text-sm font-medium text-gray-700 dark:bg-gray-700 dark:text-gray-200",children:g()}),m()&&e.jsx("span",{className:"rounded-full bg-gray-200 px-3 py-1 text-sm font-medium text-gray-700 dark:bg-gray-700 dark:text-gray-200",children:m()}),y()&&e.jsx("span",{className:"rounded-full bg-gray-200 px-3 py-1 text-sm font-medium text-gray-700 dark:bg-gray-700 dark:text-gray-200",children:y()})]})]}),e.jsxs(l.div,{className:"space-y-3",initial:{opacity:0},animate:{opacity:1},transition:{duration:.5,delay:.5},children:[p()&&e.jsxs("div",{className:"text-gray-600 dark:text-gray-300",children:[e.jsx("span",{className:"font-semibold text-gray-900 dark:text-white",children:"导演："}),e.jsx("span",{children:p()})]}),h()&&e.jsxs("div",{className:"text-gray-600 dark:text-gray-300",children:[e.jsx("span",{className:"font-semibold text-gray-900 dark:text-white",children:"演员："}),e.jsx("span",{children:h()})]})]}),u()&&e.jsxs(l.div,{className:"mt-4 rounded-xl bg-gray-50/50 p-4 dark:bg-gray-800/50",initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{duration:.5,delay:.6},children:[e.jsx("h3",{className:"mb-2 font-semibold text-gray-900 dark:text-white",children:"剧情简介"}),e.jsx("div",{className:"text-sm leading-relaxed text-gray-600 dark:text-gray-300",dangerouslySetInnerHTML:{__html:u()}})]})]})})]})]}),t?.videoInfo?.episodes_names&&t.videoInfo.episodes_names.length>0&&e.jsxs(l.div,{className:"mt-6 overflow-hidden rounded-2xl bg-white/40 shadow-xl shadow-black/5 backdrop-blur-xl dark:bg-white/10",initial:{opacity:0,y:30},animate:{opacity:1,y:0},transition:{duration:.5,delay:.3},children:[e.jsx("div",{className:"border-b border-gray-200/50 p-4 dark:border-gray-700/50",children:e.jsxs("div",{className:"flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"h-8 w-1 rounded-full bg-gradient-to-b from-blue-500 to-purple-500"}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900 dark:text-white",children:"选集"}),e.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:["共 ",t.videoInfo.episodes_names.length," 集"]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(P,{size:"sm",variant:"flat",onPress:()=>C(!o),startContent:o?e.jsx(X,{size:16}):e.jsx(Z,{size:16}),className:"bg-gray-100 font-medium text-gray-700 hover:bg-gray-200 dark:bg-gray-700 dark:text-gray-200 dark:hover:bg-gray-600",children:o?"正序":"倒序"}),j.length>1&&e.jsx(O,{size:"sm",selectedKeys:[k],onChange:a=>A(a.target.value),className:"w-28",classNames:{trigger:"bg-gray-100 border-none font-medium dark:bg-gray-700",value:"text-gray-700 dark:text-gray-200",popoverContent:"bg-white/90 backdrop-blur-xl border border-gray-200/50 dark:bg-gray-800/90"},"aria-label":"选择集数范围",children:j.map(a=>e.jsx(B,{children:a.label},a.value))})]})]})}),e.jsx("div",{className:"grid grid-cols-2 gap-2 p-4 sm:grid-cols-3 md:grid-cols-5 lg:grid-cols-6 xl:grid-cols-8",children:M.map(({name:a,displayIndex:r},s)=>e.jsx(l.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},transition:{duration:.3,delay:s*.02,ease:"easeOut"},children:e.jsx(F,{content:a,placement:"top",delay:1e3,children:e.jsx(l.button,{whileHover:{scale:1.02},whileTap:{scale:.98},onClick:()=>L(r),className:"relative w-full overflow-hidden rounded-xl bg-black px-3 py-2 text-sm font-medium text-white transition-all duration-300 hover:bg-black/80 hover:shadow-md",children:e.jsx("span",{className:"relative z-10 block overflow-hidden text-ellipsis whitespace-nowrap",children:a})})})},`${a}-${r}`))})]})]})}export{re as default};
